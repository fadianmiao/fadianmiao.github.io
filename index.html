<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€å¹´å‹å¥½åº”ç”¨</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: "SimHei", sans-serif;
            background-color: #fff8f9;
            color: #333;
            background-image: url("./images/èƒŒæ™¯å›¾.jpg");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        .container {
            width: 100%;
            height: 100vh;
            position: relative;
            box-sizing: border-box;
            padding: 30px;
            background-color: rgba(255, 255, 255, 0.7);
        }
        /* æ—¶é—´æ ·å¼ */
        .time {
            font-size: 32px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 50px;
            color: #333;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }
        /* ä¸»å¸ƒå±€å®¹å™¨ */
        .main-content {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: calc(100% - 180px);
            padding: 0 50px;
        }
        /* å·¦ä¾§åŠŸèƒ½æŒ‰é’® */
        .function-buttons {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        .func-btn {
            width: 220px;
            height: 80px;
            background-color: #fff;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #f8c3cd;
        }
        .func-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            background-color: #fff5f7;
        }
        .func-btn .icon {
            font-size: 32px;
        }
        /* ä¸­é—´å®¶åº­åˆå½± */
        .family-photo {
            width: 700px;
            height: 600px;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            border: 5px solid #fff;
        }
        .family-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        /* åº•éƒ¨å¯¹è¯æŒ‰é’® */
        .dialog-btn {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 80px;
            background-color: #fff;
            border-radius: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #f8c3cd;
        }
        .dialog-btn:hover {
            transform: translateX(-50%) translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            background-color: #fff5f7;
        }
        .dialog-btn .icon {
            font-size: 32px;
        }
    
        .content-container {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 40px;
            padding: 50px;
            margin-top: 50px;
            border: 2px solid #f8c3cd;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* å¤©æ°”é¡µé¢æ ·å¼ä¼˜åŒ– */
        .weather-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        .temp {
            font-size: 64px;
            font-weight: bold;
            text-align: center;
            margin: 30px 0;
            color: #333;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: baseline;
            gap: 35px;
        }
        .temp span:first-child {
            font-size: 96px;
            color: #ff5722;
        }
        .info {
            display: flex;
            justify-content: center;
            font-size: 28px;
            gap: 40px;
            flex-wrap: wrap;
        }
        .forecast {
            display: flex;
            justify-content: space-around;
            margin-top: 25px;
            flex-wrap: wrap;
            gap: 20px;
        }
        .forecast-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            background-color: #fff;
            padding: 15px;
            border-radius: 15px;
            width: 100px;
            border: 1px solid #f8b9c4;
            font-size: 20px;
        }
        .forecast-item img {
            width: 50px;
            height: 50px;
        }
        .suggestion {
            font-size: 24px;
            margin-top: 30px;
            padding: 20px 25px;
            border-radius: 10px;
            border-left: 5px solid;
            line-height: 1.6;
        }
        .weather-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto;
            display: block;
        }
/* å¤©æ°”é¡µé¢æ ·å¼ - æŒ‰ç…§é•¿æ²™å¤©æ°”é¡µé¢å¸ƒå±€ */
.weather-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding: 20px;
}

.city-title {
    font-size: 32px;
    font-weight: bold;
    text-align: center;
    color: #2d3748;
    margin-bottom: 8px;
}

.city-subtitle {
    font-size: 18px;
    color: #718096;
    text-align: center;
    margin-bottom: 30px;
}

.weather-main {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 30px;
    margin: 30px 0;
}

.weather-icon {
    width: 120px;
    height: 120px;
}

.temp-container {
    line-height: 1;
}

.current-temp {
    font-size: 80px;
    font-weight: bold;
    color: #2d3748;
}

.weather-desc {
    font-size: 28px;
    color: #4a5568;
    margin-top: 12px;
}

.weather-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin: 40px 0;
}

.detail-item {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 15px;
    text-align: left;
    border: 1px solid #f8c3cd;
}

.detail-label {
    font-size: 18px;
    color: #9f7aea;
    margin-bottom: 8px;
    font-weight: 500;
}

.detail-value {
    font-size: 24px;
    color: #2d3748;
    font-weight: 500;
}

.update-time {
    font-size: 16px;
    color: #a0aec0;
    margin-top: 20px;
    text-align: center;
}

.error-message {
    color: #e53e3e;
    font-size: 20px;
    margin: 20px 0;
    padding: 15px;
    border-radius: 10px;
    background: #fee;
    text-align: center;
    border: 1px solid #f8c3cd;
}
/* æ–°å¢æš–å¿ƒå»ºè®®æ ·å¼ */
        .warm-suggestion {
            background-color: #fff9f0;
            border-left: 5px solid #ffb347;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 22px;
            line-height: 1.6;
            color: #8b4513;
        }

        /* è¯­éŸ³æ’­æŠ¥çŠ¶æ€æç¤º */
        .voice-status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-size: 22px;
            background-color: #f0f8ff;
            border: 2px solid #87ceeb;
        }

        .voice-status.playing {
            background-color: #f0fff0;
            border-color: #90ee90;
        }

        /* è¯­éŸ³æ§åˆ¶æŒ‰é’® */
        .voice-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        .voice-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            background: #f8c3cd;
            color: #fff;
            font-size: 36px;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .voice-btn:hover {
            transform: scale(1.1);
            background: #ff8a9a;
        }
        .voice-btn.playing {
            background: #90ee90;
        }


        /* éŸ³ä¹é¡µé¢æ ·å¼ - å·¦å³å¸ƒå±€ */
        .music-container {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 40px;
            padding: 20px;
            height: calc(100% - 100px);
        }
        .vinyl-area {
            width: 40%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .vinyl-container {
            position: relative;
            width: 300px;
            height: 300px;
        }
        .vinyl {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: rotate 15s linear infinite;
            animation-play-state: paused;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .arm {
            position: absolute;
            top: -30px;
            left: 50%;
            width: 100px;
            height: 12px;
            background: #fff;
            transform: translateX(-50%) rotate(-25deg);
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .lyrics-area {
            width: 60%;
            display: flex;
            flex-direction: column;
            gap: 25px;
            overflow-y: auto;
            padding: 20px 0;
        }
        #song-info {
            text-align: left;
        }
        #song-info h2 {
            font-size: 36px;
            margin: 0 0 10px 0;
        }
        #song-info p {
            font-size: 22px;
            margin: 0;
            color: #666;
        }
        .lyrics {
            font-size: 24px;
            line-height: 2.2;
            background-color: #fff;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.05);
            border: 1px solid #f8b9c4;
            text-align: left;
            height: 300px;
            overflow-y: auto;
        }
        .progress-container {
            width: 100%;
            max-width: 100%;
            height: 10px;
            background: #ddd;
            border-radius: 5px;
            overflow: hidden;
            cursor: pointer;
        }
        .progress-bar {
            height: 100%;
            width: 0;
            background: #4285f4;
            border-radius: 5px;
            transition: width 0.1s linear;
        }
        .controls {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        .controls button {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            background: #4285f4;
            color: #fff;
            font-size: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }
        .controls button:hover {
            background: #3367d6;
            transform: scale(1.05);
        }
        .music-list {
            margin-top: 30px;
            width: 100%;
        }
        .music-list h3 {
            font-size: 26px;
            text-align: center;
            margin-bottom: 20px;
        }
        .song-item {
            font-size: 22px;
            padding: 15px;
            margin: 10px 0;
            background: #fff5f7;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }
        .song-item:hover, .song-item.active {
            background: #ffe6eb;
            transform: translateY(-3px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        /* ä¹¦æ¶é¡µé¢æ ·å¼ */
        .bookcase-container {
            padding: 30px;
        }

        /* æ¦œå•å¯¼èˆª */
        .ranking-tabs {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            font-size: 28px;
            font-weight: bold;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8c3cd;
        }

        .ranking-tabs .active {
            color: #ff5722;
            position: relative;
        }

        .ranking-tabs .active::after {
            content: '';
            position: absolute;
            bottom: -17px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #ff5722;
        }

        /* ä¹¦ç±åˆ—è¡¨ */
        .book-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* ä¸¤åˆ—å¸ƒå±€ */
            gap: 30px;
        }

        .book-item {
            display: flex;
            align-items: flex-start;
            gap: 20px;
            background-color: #fff;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .book-item:hover {
            transform: translateY(-5px);
        }

        .book-item img {
            width: 120px;
            height: 160px;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        .book-rank {
            font-size: 32px;
            font-weight: bold;
            color: #ff5722;
            margin-top: 5px;
        }

        .book-info {
            flex: 1;
        }

        .book-info h3 {
            font-size: 26px;
            margin: 0 0 10px 0;
            color: #333;
        }

        .book-info p {
            font-size: 20px;
            color: #666;
            margin: 0;
        }


        /* å°è¯´é¡µé¢ */
        .novel-container {
            padding: 35px;
            font-size: 24px;
            line-height: 2.2;
            height: calc(100vh - 180px);
            overflow-y: auto;
        }
        .novel-container h2 {
            text-align: center;
            color: #2b2d42;
            margin-bottom: 25px;
            font-size: 36px;
        }
        .novel-container p {
            margin-bottom: 25px;
            text-indent: 2em;
        }

        /* å¯¹è¯é¡µé¢æ ·å¼ */
        #dialog-page {
            background-color: #fef9f7;
            position: relative;
            overflow: hidden;
        }
        .family-group-center {
            width: 500px;
            height: 500px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            border: 6px solid white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -55%);
            z-index: 2;
        }
        .family-group-center img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .avatar {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
            border: 4px solid white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: absolute;
            z-index: 3;
        }
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .avatar:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(0,0,0,0.25);
        }
        .avatar-left-top { top: 30%; left: 20%; transform: translate(-50%, -50%); }
        .avatar-left-bottom { top: 70%; left: 20%; transform: translate(-50%, -50%); }
        .avatar-right-top { top: 30%; right: 20%; transform: translate(50%, -50%); }
        .avatar-right-bottom { top: 70%; right: 20%; transform: translate(50%, -50%); }
        .dialog-tip {
            position: absolute;
            top: 88%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28px;
            font-weight: bold;
            color: #333;
            z-index: 4;
            padding: 10px 20px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
        }

        /* è§†é¢‘é¡µé¢æ ·å¼ */
        #video-page {
            display: none;
            background-color: #000;
        }
        .video-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #avatar-video {
            width: 80%;
            max-width: 800px;
            height: auto;
            max-height: 80vh;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }
        .video-controls {
            margin-top: 20px;
            display: flex;
            gap: 20px;
        }
        .video-btn {
            padding: 15px 30px;
            font-size: 24px;
            background-color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }
        .video-btn:hover {
            background-color: #f0f0f0;
        }

        /* è¿”å›æŒ‰é’®é€šç”¨æ ·å¼ */
        .back-btn {
            position: absolute;
            top: 30px;
            left: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            font-size: 28px;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 2px solid #f8c3cd;
            z-index: 10;
        }
        .back-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 12px rgba(0,0,0,0.15);
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 1024px) {
            .music-container {
                flex-direction: column;
                align-items: center;
            }
            .vinyl-area, .lyrics-area {
                width: 100%;
            }
            .vinyl-container {
                width: 250px;
                height: 250px;
            }
            #avatar-video {
                width: 95%;
            }
        }
        
        /* è¯­éŸ³æ€§åˆ«é€‰æ‹©æç¤º */
        .gender-selection-tip {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            font-size: 24px;
            z-index: 1000;
            display: none;
        }
        
    </style>
</head>
<body>
    <!-- ä¸»é¡µé¢ -->
    <div class="container" id="main-page">
        <div class="time" id="current-time">2025å¹´10æœˆ10æ—¥ 13:40</div>
        <div class="main-content">
            <div class="function-buttons">
                <div class="func-btn" id="to-weather">
                    å¤©æ°” <span class="icon">â˜ï¸</span>
                </div>
                <div class="func-btn" id="to-music">
                    éŸ³ä¹ <span class="icon">ğŸµ</span>
                </div>
                <div class="func-btn" id="to-novel">
                    å°è¯´ <span class="icon">ğŸ“š</span>
                </div>
            </div>
            <div class="family-photo">
                <img src="./images/å®¶åº­åˆå½±.png" alt="å®¶åº­åˆå½±">
            </div>
        </div>
        <div class="dialog-btn" id="to-dialog">
            å¯¹è¯ <span class="icon">ğŸ’¬</span>
        </div>
    </div>
<!-- å¤©æ°”é¡µé¢ - ä¿®æ”¹ä¸ºé•¿æ²™å®æ—¶å¤©æ°” -->
<div class="container" id="weather-page">
        <div class="back-btn" id="back-from-weather">â†</div>
        <div class="content-container weather-container">
            <div class="city-title">é•¿æ²™å¸‚</div>
            <div class="city-subtitle">æ¹–å—çœ çœä¼š</div>

            <!-- è¯­éŸ³æ’­æŠ¥çŠ¶æ€æç¤º -->
            <div class="voice-status" id="voice-status">
                æ­£åœ¨ä¸ºæ‚¨æ’­æŠ¥å¤©æ°”æƒ…å†µå’Œç”Ÿæ´»å»ºè®®...
            </div>

            <!-- è¯­éŸ³æ§åˆ¶æŒ‰é’® -->
            <div class="voice-controls">
                <button class="voice-btn" id="replay-voice-btn">ğŸ”Š</button>
                <button class="voice-btn" id="stop-voice-btn">â¹ï¸</button>
            </div>
            <p style="font-size: 20px; text-align: center; color: #666;">
                é‡æ–°æ’­æ”¾ï¼šğŸ”Š æŒ‰é’® | åœæ­¢æ’­æ”¾ï¼šâ¹ï¸ æŒ‰é’®
            </p>
            
            <div class="weather-main">
                <div class="temp-container" style="text-align: center;">
                    <div class="current-temp" id="temp">--â„ƒ</div>
                    <div class="weather-desc" id="weatherDesc">åŠ è½½ä¸­...</div>
                </div>
            </div>

            <div class="weather-details">
                <div class="detail-item">
                    <div class="detail-label">ç©ºæ°”æ¹¿åº¦</div>
                    <div class="detail-value" id="humidity">--%</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">é£å‘é£åŠ›</div>
                    <div class="detail-value" id="wind">--</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">å¤§æ°”å‹åŠ›</div>
                    <div class="detail-value" id="pressure">-- hPa</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">èƒ½è§åº¦</div>
                    <div class="detail-value" id="visibility">-- km</div>
                </div>
            </div>

            <!-- æš–å¿ƒå»ºè®®åŒºåŸŸ -->
            <div class="warm-suggestion" id="warm-suggestion">
                æš–å¿ƒå»ºè®®åŠ è½½ä¸­...
            </div>

            <div class="update-time" id="updateTime">æœ€åæ›´æ–°ï¼šåŠ è½½ä¸­...</div>
            <div class="error-message" id="error"></div>
        </div>
    </div>
            
    <!-- éŸ³ä¹é¡µé¢ -->
    <div class="container" id="music-page">
        <div class="back-btn" id="back-from-music">â†</div>
        <div class="content-container music-container">
            <!-- å·¦ä¾§å…‰ç›˜åŒºåŸŸ -->
            <div class="vinyl-area">
                <div class="vinyl-container">
                    <img src="./images/éŸ³ä¹.jpg" alt="éŸ³ä¹å…‰ç›˜" class="vinyl">
                    <div class="arm"></div>
                </div>
            </div>
            
            <!-- å³ä¾§æ­Œè¯ä¸æ§åˆ¶åŒºåŸŸ -->
            <div class="lyrics-area">
                <!-- æ­Œæ›²ä¿¡æ¯æ˜¾ç¤ºåŒº -->
                <div id="song-info">
                    <h2>æ­Œå”±ç¥–å›½</h2>
                    <p>ä¸“è¾‘ï¼šç¥–å›½é¢‚ | æ­Œæ‰‹ï¼šä¸œæ–¹çº¢åˆå”±é˜Ÿ</p>
                </div>
                
                <!-- æ­Œè¯æ˜¾ç¤ºåŒº -->
                <div class="lyrics" id="song-lyrics">
                    è¶Šè¿‡é«˜å±± è¶Šè¿‡å¹³åŸ<br />
                    è·¨è¿‡å¥”è…¾çš„é»„æ²³é•¿æ±Ÿ<br />
                    å®½å¹¿ç¾ä¸½çš„åœŸåœ°<br />
                    æ˜¯æˆ‘ä»¬äº²çˆ±çš„å®¶ä¹¡<br />
                    è‹±é›„çš„äººæ°‘ ç«™èµ·æ¥äº†<br />
                    æˆ‘ä»¬å›¢ç»“å‹çˆ± åšå¼ºå¦‚é’¢<br />
                    äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬<br />
                    èƒœåˆ©æ­Œå£°å¤šä¹ˆå“äº®<br />
                    æ­Œå”±æˆ‘ä»¬äº²çˆ±çš„ç¥–å›½<br />
                    ä»ä»Šèµ°å‘ç¹è£å¯Œå¼º<br />
                    æ­Œå”±æˆ‘ä»¬äº²çˆ±çš„ç¥–å›½<br />
                    ä»ä»Šèµ°å‘ç¹è£å¯Œå¼º
                </div>
                
                <!-- è¿›åº¦æ¡ -->
                <div class="progress-container" id="progress-container">
                    <div class="progress-bar"></div>
                </div>
                
                <!-- æ’­æ”¾æ§åˆ¶æŒ‰é’® -->
                <div class="controls">
                    <button id="prev">â®</button>
                    <button id="playPause">â–¶</button>
                    <button id="next">â¯</button>
                </div>
                
                <!-- éŸ³ä¹åˆ—è¡¨ -->
                <div class="music-list">
                    <h3>æ­Œæ›²åˆ—è¡¨</h3>
                    <div class="song-item active" data-index="0">
                        æ­Œå”±ç¥–å›½ - ä¸œæ–¹çº¢åˆå”±é˜Ÿ
                    </div>
                    <div class="song-item" data-index="1">
                        èŒ‰è‰èŠ± - ç»å…¸æ°‘æ­Œ
                    </div>
                    <div class="song-item" data-index="2">
                        æ˜ å±±çº¢ - çº¢æ­Œç²¾é€‰
                    </div>
                </div>
            </div>
        </div>
        
        <!-- éŸ³é¢‘å…ƒç´  -->
        <audio id="audio" preload="metadata">
            <source src="./music/ä¸œæ–¹çº¢åˆå”±é˜Ÿ - æ­Œå”±ç¥–å›½_L.ogg" type="audio/ogg">
            <source src="./music/å®‹ç¥–è‹± - èŒ‰è‰èŠ±_L.ogg" type="audio/ogg">
            <source src="./music/ææ˜Ÿè¯º - æ˜ å±±çº¢_L.ogg" type="audio/ogg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
        </audio>
    </div>

    <!-- ä¹¦æ¶é¡µé¢ -->
    <div class="container" id="bookcase-page">
        <div class="back-btn" id="back-to-main-from-bookcase">â†</div>
        <div class="content-container bookcase-container">
            <!-- æ¦œå•å¯¼èˆª -->
            <div class="ranking-tabs">
                <span class="active">æ–‡å­¦ç»å…¸</span>
                <span>å¥åº·å…»ç”Ÿ</span>
                <span>æ™šå¹´ç”Ÿæ´»</span>
                <span>å…´è¶£æ‹“å±•</span>
            </div>
            
            <!-- ä¹¦ç±åˆ—è¡¨ï¼ˆæŒ‰æˆªå›¾æ ·å¼å±•ç¤ºï¼‰ -->
            <div class="book-list">
                <!-- ä¹¦ç±1ï¼šå¹³å‡¡çš„ä¸–ç•Œ -->
                <div class="book-item" data-book="å¹³å‡¡çš„ä¸–ç•Œ">
                    <img src="./images/æ–‡å­¦ç»å…¸/å¹³å‡¡çš„ä¸–ç•Œ.webp" alt="å¹³å‡¡çš„ä¸–ç•Œ">
                    <div class="book-rank">1</div>
                    <div class="book-info">
                        <h3>å¹³å‡¡çš„ä¸–ç•Œ</h3>
                    </div>
                </div>
                
                <!-- ä¹¦ç±2ï¼šèµ°åˆ°äººç”Ÿè¾¹ä¸Š -->
                <div class="book-item" data-book="èµ°åˆ°äººç”Ÿè¾¹ä¸Š">
                    <img src="./images/æ–‡å­¦ç»å…¸/èµ°åˆ°äººç”Ÿè¾¹ä¸Š.webp" alt="èµ°åˆ°äººç”Ÿè¾¹ä¸Š">
                    <div class="book-rank">2</div>
                    <div class="book-info">
                        <h3>èµ°åˆ°äººç”Ÿè¾¹ä¸Š</h3>
                    </div>
                </div>
                
                <!-- æµ®ç”Ÿå…­è®° -->
                <div class="book-item" data-book="æµ®ç”Ÿå…­è®°">
                    <img src="./images/æ–‡å­¦ç»å…¸/æµ®ç”Ÿå…­è®°.webp" alt="æµ®ç”Ÿå…­è®°">
                    <div class="book-rank">3</div>
                    <div class="book-info">
                        <h3>æµ®ç”Ÿå…­è®°</h3>
                    </div>
                </div>
                
                <!-- æ´»ç€ -->
                <div class="book-item" data-book="æ´»ç€">
                    <img src="./images/æ–‡å­¦ç»å…¸/æ´»ç€.webp" alt="æ´»ç€">
                    <div class="book-rank">4</div>
                    <div class="book-info">
                        <h3>æ´»ç€</h3>
                    </div>
                </div>

                <!-- å¤•é˜³çº¢ -->
                <div class="book-item" data-book="å¤•é˜³çº¢">
                    <img src="./images/æ–‡å­¦ç»å…¸/å¤•é˜³çº¢.webp" alt="å¤•é˜³çº¢">
                    <div class="book-rank">5</div>
                    <div class="book-info">
                        <h3>å¤•é˜³çº¢</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å°è¯´é¡µé¢ï¼ˆæ–°å¢é˜…è¯»æ§åˆ¶åŠŸèƒ½ï¼‰ -->
    <div class="container" id="novel-page">
        <div class="back-btn" id="back-from-novel">â†</div>
        <!-- æ–°å¢é˜…è¯»æ§åˆ¶æ  -->
        <div class="novel-controls" style="position: absolute; top: 100px; left: 50%; transform: translateX(-50%); z-index: 10; display: flex; gap: 20px; background: rgba(255,255,255,0.9); padding: 10px 20px; border-radius: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <button onclick="changeFontSize(-1)" style="font-size: 24px; padding: 5px 15px; border-radius: 20px; border: 1px solid #f8c3cd; background: white; cursor: pointer;">A-</button>
            <button onclick="changeFontSize(1)" style="font-size: 24px; padding: 5px 15px; border-radius: 20px; border: 1px solid #f8c3cd; background: white; cursor: pointer;">A+</button>
            <button onclick="toggleNightMode()" style="font-size: 24px; padding: 5px 15px; border-radius: 20px; border: 1px solid #f8c3cd; background: white; cursor: pointer;">ğŸŒ™ å¤œé—´æ¨¡å¼</button>
        </div>
        <div class="content-container novel-container" id="novel-content">
            <!-- å°è¯´å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            <h2>è¯·é€‰æ‹©ä¸€æœ¬å°è¯´é˜…è¯»</h2>
            <p>ç‚¹å‡»ä¹¦æ¶ä¸­çš„ä¹¦ç±å¼€å§‹é˜…è¯»</p>
        </div>
    </div>

    <!-- å¯¹è¯é¡µé¢ -->
    <div class="container" id="dialog-page">
        <div class="back-btn" id="back-to-main-from-dialog">â†</div>
        <div class="family-group-center">
            <img src="./images/å®¶åº­åˆå½±.png" alt="å®¶åº­åˆå½±">
        </div>
        <div class="avatar avatar-left-top" data-gender="daughter" data-person="å„¿åª³">
            <img src="./images/å„¿åª³.png" alt="å„¿åª³">
        </div>
        <div class="avatar avatar-left-bottom" data-gender="son" data-person="å„¿å­">
            <img src="./images/å„¿å­.png" alt="å„¿å­">
        </div>
        <div class="avatar avatar-right-top" data-gender="daughter" data-person="å­™å¥³">
            <img src="./images/å­™å¥³.png" alt="å­™å¥³">
        </div>
        <div class="avatar avatar-right-bottom" data-gender="son" data-person="å­™å­">
            <img src="./images/å­™å­.png" alt="å­™å­">
        </div>
        <div class="dialog-tip">ç‚¹å‡»å¤´åƒå¼€å§‹å¯¹è¯</div>
    </div>
    
 <!-- è§†é¢‘é¡µé¢ -->
<div class="container" id="video-page">
    <div class="back-btn" id="back-from-video">â†</div>
    <div class="video-container">
        <video id="avatar-video" autoplay>
            <!-- è§†é¢‘æºå°†æ ¹æ®é€‰æ‹©çš„äººç‰©åŠ¨æ€è®¾ç½® -->
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
        </video>
        <div class="video-controls">
            <button class="video-btn" id="stop-conversation">ç»“æŸå¯¹è¯</button>
        </div>
    </div>
</div>
    
    <!-- è¯­éŸ³æ€§åˆ«é€‰æ‹©æç¤º -->
    <div class="gender-selection-tip" id="gender-tip"></div>
<script>
    // å®æ—¶æ—¶é—´æ›´æ–°
    function updateTime() {
        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth() + 1;
        const day = now.getDate();
        const week = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][now.getDay()];
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const timeStr = `${year}å¹´${month}æœˆ${day}æ—¥ æ˜ŸæœŸ${week} ${hours}:${minutes}`;
        document.getElementById('current-time').textContent = timeStr;
    }
    updateTime();
    setInterval(updateTime, 60000);

    // é•¿æ²™å®æ—¶å¤©æ°”åŠŸèƒ½
    const QWEATHER_KEY = "605733f6762a466aacb10eae2380b552";
    const CHANGSHA_CITY_ID = "101250101";
    const WEATHER_API = `https://ku6x88cb5m.re.qweatherapi.com/v7/weather/now?location=${CHANGSHA_CITY_ID}&key=${QWEATHER_KEY}`;

    // è·å–DOMå…ƒç´ 
    const tempEl = document.getElementById('temp');
    const weatherDescEl = document.getElementById('weatherDesc');
    const humidityEl = document.getElementById('humidity');
    const windEl = document.getElementById('wind');
    const pressureEl = document.getElementById('pressure');
    const visibilityEl = document.getElementById('visibility');
    const updateTimeEl = document.getElementById('updateTime');
    const errorEl = document.getElementById('error');
    const warmSuggestionEl = document.getElementById('warm-suggestion');
    const voiceStatusEl = document.getElementById('voice-status');
    const replayVoiceBtn = document.getElementById('replay-voice-btn');
    const stopVoiceBtn = document.getElementById('stop-voice-btn');

    // å­˜å‚¨å½“å‰å¤©æ°”æ•°æ®
    let currentWeatherData = {};
    let isSpeaking = false; // è¯­éŸ³æ’­æŠ¥çŠ¶æ€

    // ç”Ÿæˆæš–å¿ƒå»ºè®®å‡½æ•°
    function generateWarmSuggestion(weatherData) {
        const temp = parseInt(weatherData.temp);
        const weatherDesc = weatherData.text;
        const humidity = parseInt(weatherData.humidity);
        
        let suggestion = "";
        
        // æ ¹æ®æ¸©åº¦ç”Ÿæˆå»ºè®®
        if (temp < 5) {
            suggestion += "å¤©æ°”å¯’å†·ï¼Œè¯·æ‚¨ç©¿ä¸Šåšæ£‰è¡£ã€ç¾½ç»’æœï¼Œæ³¨æ„é˜²å¯’ä¿æš–ã€‚å‡ºé—¨è®°å¾—æˆ´ä¸Šå›´å·¾å’Œæ‰‹å¥—ã€‚";
        } else if (temp < 15) {
            suggestion += "å¤©æ°”è¾ƒå‡‰ï¼Œå»ºè®®æ‚¨ç©¿ä¸Šæ¯›è¡£æˆ–è–„æ£‰è¡£ï¼Œæ—©æ™šæ¸©å·®å¤§ï¼Œæ³¨æ„æ·»è¡£ä¿æš–ã€‚";
        } else if (temp < 25) {
            suggestion += "å¤©æ°”èˆ’é€‚ï¼Œé€‚åˆæˆ·å¤–æ´»åŠ¨ã€‚æ‚¨å¯ä»¥é€‚å½“æ•£æ­¥ï¼Œä½†è¦æ³¨æ„é˜²æ™’ã€‚";
        } else if (temp < 32) {
            suggestion += "å¤©æ°”è¾ƒçƒ­ï¼Œå»ºè®®æ‚¨ç©¿ç€è½»è–„é€æ°”çš„è¡£ç‰©ï¼Œå¤šå–æ°´é˜²ä¸­æš‘ã€‚";
        } else {
            suggestion += "å¤©æ°”ç‚çƒ­ï¼Œè¯·æ‚¨å‡å°‘æˆ·å¤–æ´»åŠ¨ï¼Œå¤šå¾…åœ¨é˜´å‡‰å¤„ï¼ŒåŠæ—¶è¡¥å……æ°´åˆ†ã€‚";
        }
        
        // æ ¹æ®å¤©æ°”çŠ¶å†µç”Ÿæˆå»ºè®®
        if (weatherDesc.includes('é›¨')) {
            suggestion += " ä»Šå¤©æœ‰é›¨ï¼Œå‡ºé—¨è¯·è®°å¾—å¸¦ä¼ï¼Œæ³¨æ„è·¯é¢æ¹¿æ»‘ï¼Œè¡Œèµ°è¦å°å¿ƒã€‚";
        } else if (weatherDesc.includes('é›ª')) {
            suggestion += " ä»Šå¤©æœ‰é›ªï¼Œè·¯é¢å¯èƒ½ç»“å†°ï¼Œè¯·å°½é‡å‡å°‘å¤–å‡ºï¼Œå¦‚éœ€å‡ºé—¨è¯·ç©¿é˜²æ»‘é‹ã€‚";
        } else if (weatherDesc.includes('æ™´')) {
            suggestion += " ä»Šå¤©å¤©æ°”æ™´æœ—ï¼Œé€‚åˆå¼€çª—é€šé£ï¼Œä¹Ÿå¯ä»¥æ™¾æ™’è¢«è¤¥ã€‚";
        } else if (weatherDesc.includes('é˜´') || weatherDesc.includes('å¤šäº‘')) {
            suggestion += " ä»Šå¤©å¤©æ°”ä»¥é˜´æˆ–å¤šäº‘ä¸ºä¸»ï¼Œé€‚åˆå¤–å‡ºæ•£æ­¥ï¼Œä½†æœ€å¥½å¸¦ä¸Šé›¨å…·ä»¥é˜²ä¸‡ä¸€ã€‚";
        }
        
        // æ ¹æ®æ¹¿åº¦ç”Ÿæˆå»ºè®®
        if (humidity > 80) {
            suggestion += " ç©ºæ°”æ¹¿åº¦è¾ƒé«˜ï¼Œè¯·æ³¨æ„é˜²æ½®ï¼Œå¯ä»¥é€‚å½“å¼€å¯é™¤æ¹¿è®¾å¤‡ã€‚";
        } else if (humidity < 30) {
            suggestion += " ç©ºæ°”è¾ƒä¸ºå¹²ç‡¥ï¼Œè¯·å¤šå–æ°´ï¼Œå¯ä»¥ä½¿ç”¨åŠ æ¹¿å™¨ä¿æŒå®¤å†…èˆ’é€‚ã€‚";
        }
        
        // é€šç”¨æš–å¿ƒæé†’
        suggestion += " ç¥æ‚¨èº«ä½“å¥åº·ï¼Œå¿ƒæƒ…æ„‰å¿«ï¼";
        
        return suggestion;
    }

    // åœæ­¢å¤©æ°”è¯­éŸ³æ’­æŠ¥
    function stopWeatherSpeech() {
        if (isSpeaking) {
            speechSynthesis.cancel();
            isSpeaking = false;
            voiceStatusEl.textContent = "è¯­éŸ³æ’­æŠ¥å·²åœæ­¢";
            voiceStatusEl.classList.remove('playing');
            replayVoiceBtn.classList.remove('playing');
        }
    }

    // è¯­éŸ³æ’­æŠ¥å‡½æ•°
    function speakWeather() {
        if (!currentWeatherData.temp) {
            voiceStatusEl.textContent = "å¤©æ°”æ•°æ®å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åå†è¯•";
            return;
        }

        // è·å–å·²æ¸²æŸ“çš„å¤©æ°”æ•°æ®
        const city = "é•¿æ²™å¸‚";
        const temp = tempEl.textContent || "æœªçŸ¥";
        const desc = weatherDescEl.textContent || "æœªçŸ¥";
        const humidity = humidityEl.textContent || "æœªçŸ¥";
        const wind = windEl.textContent || "æœªçŸ¥";
        const suggestion = warmSuggestionEl.textContent || "";

        // æ„é€ é€‚åˆè€å¹´äººçš„ç®€æ´æ’­æŠ¥æ–‡æ¡ˆ
        const weatherText = `
            ${city}å½“å‰å¤©æ°”${desc}ï¼Œæ°”æ¸©${temp}ã€‚
            ç©ºæ°”æ¹¿åº¦${humidity}ï¼Œé£å‘é£åŠ›${wind}ã€‚
            ${suggestion}
        `;

        // ä½¿ç”¨Web Speech APIå®ç°æ’­æŠ¥
        const speech = new SpeechSynthesisUtterance();
        speech.text = weatherText.replace(/\s+/g, " "); // å»é™¤å¤šä½™ç©ºæ ¼
        speech.lang = "zh-CN"; // ä¸­æ–‡å‘éŸ³
        speech.rate = 0.9; // è¯­é€Ÿæ”¾ç¼“ï¼ˆé»˜è®¤1ï¼Œ0.9æ›´é€‚åˆè€äººï¼‰
        speech.volume = 1; // éŸ³é‡æœ€å¤§
        speech.pitch = 1.1; // éŸ³è°ƒç¨é«˜ï¼Œæ›´æ¸…æ™°

        // æ’­æŠ¥çŠ¶æ€ç®¡ç†
        speechSynthesis.cancel(); // å–æ¶ˆä¹‹å‰çš„æ’­æŠ¥
        speechSynthesis.speak(speech);
        isSpeaking = true;

        // æ›´æ–°ç•Œé¢çŠ¶æ€
        voiceStatusEl.textContent = "æ­£åœ¨ä¸ºæ‚¨æ’­æŠ¥å¤©æ°”æƒ…å†µå’Œç”Ÿæ´»å»ºè®®...";
        voiceStatusEl.classList.add('playing');
        replayVoiceBtn.classList.add('playing');

        // æ’­æŠ¥ç»“æŸå›è°ƒ
        speech.onend = () => {
            isSpeaking = false;
            voiceStatusEl.textContent = "å¤©æ°”æ’­æŠ¥å·²å®Œæˆ";
            voiceStatusEl.classList.remove('playing');
            replayVoiceBtn.classList.remove('playing');
        };

        // æ’­æŠ¥é”™è¯¯å›è°ƒ
        speech.onerror = () => {
            isSpeaking = false;
            voiceStatusEl.textContent = "è¯­éŸ³æ’­æŠ¥å‡ºç°é”™è¯¯";
            voiceStatusEl.classList.remove('playing');
            replayVoiceBtn.classList.remove('playing');
        };
    }

    // æ ¸å¿ƒå‡½æ•°ï¼šè¯·æ±‚é•¿æ²™å¤©æ°”å¹¶æ¸²æŸ“
    async function fetchChangshaWeather() {
        try {
            // æ¸…ç©ºé”™è¯¯æç¤º
            errorEl.textContent = '';
            // å‘é€è¯·æ±‚ï¼ˆå‰ç«¯ç›´æ¥è°ƒç”¨å’Œé£APIï¼‰
            const response = await fetch(WEATHER_API);
            const result = await response.json();

            // éªŒè¯è¯·æ±‚æ˜¯å¦æˆåŠŸ
            if (result.code !== '200' || !result.now) {
                throw new Error('è·å–é•¿æ²™å¤©æ°”å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }

            // è§£æå’Œé£è¿”å›çš„å®æ—¶æ•°æ®
            const {
                temp,       // å®æ—¶æ¸©åº¦
                text,       // å¤©æ°”çŠ¶æ€ï¼ˆæ™´/é›¨/é˜´ï¼‰
                humidity,   // æ¹¿åº¦ï¼ˆ%ï¼‰
                windDir,    // é£å‘
                windScale,  // é£åŠ›ï¼ˆçº§ï¼‰
                pressure,   // æ°”å‹ï¼ˆhPaï¼‰
                vis,        // èƒ½è§åº¦ï¼ˆkmï¼‰
                obsTime     // è§‚æµ‹æ—¶é—´ï¼ˆæ›´æ–°æ—¶é—´ï¼‰
            } = result.now;

            // æ¸²æŸ“åˆ°é¡µé¢
            tempEl.textContent = `${temp}â„ƒ`;
            weatherDescEl.textContent = text;
            humidityEl.textContent = `${humidity}%`;
            windEl.textContent = `${windDir} ${windScale}çº§`;
            pressureEl.textContent = `${pressure} hPa`;
            visibilityEl.textContent = `${vis} km`;

            // æ ¼å¼åŒ–æ›´æ–°æ—¶é—´ï¼ˆYYYY-MM-DD HH:mm:ssï¼‰
            const formatTime = obsTime.replace('T', ' ').replace(/Z$/, '');
            updateTimeEl.textContent = `æœ€åæ›´æ–°ï¼š${formatTime}`;

            // ç”Ÿæˆå¹¶æ˜¾ç¤ºæš–å¿ƒå»ºè®®
            const suggestion = generateWarmSuggestion(result.now);
            warmSuggestionEl.textContent = suggestion;

            // ä¿å­˜å½“å‰å¤©æ°”æ•°æ®
            currentWeatherData = result.now;
            
            // è‡ªåŠ¨æ’­æŠ¥å¤©æ°”ä¿¡æ¯
            setTimeout(speakWeather, 1000);

        } catch (err) {
            // é”™è¯¯å¤„ç†
            errorEl.textContent = err.message;
            console.error('é•¿æ²™å¤©æ°”è¯·æ±‚å¤±è´¥ï¼š', err);
        }
    }

    // éŸ³ä¹æ’­æ”¾æ ¸å¿ƒåŠŸèƒ½
    const audio = document.getElementById("audio");
    const vinyl = document.querySelector(".vinyl");
    const progressBar = document.querySelector(".progress-bar");
    const progressContainer = document.getElementById("progress-container");
    const playPauseBtn = document.getElementById("playPause");
    const songInfo = document.getElementById("song-info");
    const songLyrics = document.getElementById("song-lyrics");
    const songItems = document.querySelectorAll(".song-item");

    // æ­Œæ›²æ•°æ®åº“
    const songDatabase = [
        {
            title: "æ­Œå”±ç¥–å›½",
            singer: "ä¸œæ–¹çº¢åˆå”±é˜Ÿ",
            album: "ç¥–å›½é¢‚",
            src: "./music/ä¸œæ–¹çº¢åˆå”±é˜Ÿ - æ­Œå”±ç¥–å›½_L.ogg",
            lyrics: "è¶Šè¿‡é«˜å±± è¶Šè¿‡å¹³åŸ<br />è·¨è¿‡å¥”è…¾çš„é»„æ²³é•¿æ±Ÿ<br />å®½å¹¿ç¾ä¸½çš„åœŸåœ°<br />æ˜¯æˆ‘ä»¬äº²çˆ±çš„å®¶ä¹¡<br />è‹±é›„çš„äººæ°‘ ç«™èµ·æ¥äº†<br />æˆ‘ä»¬å›¢ç»“å‹çˆ± åšå¼ºå¦‚é’¢<br />äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬<br />èƒœåˆ©æ­Œå£°å¤šä¹ˆå“äº®<br />æ­Œå”±æˆ‘ä»¬äº²çˆ±çš„ç¥–å›½<br />ä»ä»Šèµ°å‘ç¹è£å¯Œå¼º<br />æ­Œå”±æˆ‘ä»¬äº²çˆ±çš„ç¥–å›½<br />ä»ä»Šèµ°å‘ç¹è£å¯Œå¼º"
        },
        {
            title: "èŒ‰è‰èŠ±",
            singer: "ç»å…¸æ°‘æ­Œ",
            album: "ä¸­å›½æ°‘æ­Œç²¾é€‰",
            src: "./music/å®‹ç¥–è‹± - èŒ‰è‰èŠ±_L.ogg",
            lyrics: "å¥½ä¸€æœµç¾ä¸½çš„èŒ‰è‰èŠ±<br />å¥½ä¸€æœµç¾ä¸½çš„èŒ‰è‰èŠ±<br />èŠ¬èŠ³ç¾ä¸½æ»¡ææ¡ <br />åˆé¦™åˆç™½äººäººå¤¸<br />è®©æˆ‘æ¥å°†ä½ æ‘˜ä¸‹<br />é€ç»™åˆ«äººå®¶<br />èŒ‰è‰èŠ±å‘€èŒ‰è‰èŠ±<br />å¥½ä¸€æœµç¾ä¸½çš„èŒ‰è‰èŠ±<br />å¥½ä¸€æœµç¾ä¸½çš„èŒ‰è‰èŠ±<br />æ»¡å›­èŠ±å¼€é¦™ä¹Ÿé¦™ä¸è¿‡å®ƒ"
        },
        {
            title: "æ˜ å±±çº¢",
            singer: "çº¢æ­Œç²¾é€‰",
            album: "çº¢è‰²ç»å…¸",
            src: "./music/ææ˜Ÿè¯º - æ˜ å±±çº¢_L.ogg",
            lyrics: "å¤œåŠä¸‰æ›´å“Ÿç›¼å¤©æ˜<br />å¯’å†¬è…Šæœˆå“Ÿç›¼æ˜¥é£<br />è‹¥è¦ç›¼å¾—å“Ÿçº¢å†›æ¥<br />å²­ä¸Šå¼€éå“Ÿæ˜ å±±çº¢<br />å²­ä¸Šå¼€éå“Ÿæ˜ å±±çº¢<br />å²­ä¸Šå¼€éå“Ÿæ˜ å±±çº¢<br />å¤œåŠä¸‰æ›´å“Ÿç›¼å¤©æ˜<br />å¯’å†¬è…Šæœˆå“Ÿç›¼æ˜¥é£<br />è‹¥è¦ç›¼å¾—å“Ÿçº¢å†›æ¥<br />å²­ä¸Šå¼€éå“Ÿæ˜ å±±çº¢"
        }
    ];

    // å½“å‰æ’­æ”¾ç´¢å¼•
    let currentSongIndex = 0;

    // æ’­æ”¾æš‚åœåˆ‡æ¢
    playPauseBtn.addEventListener("click", () => {
        if (audio.paused) {
            audio.play().catch(err => {
                alert("éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®");
                console.log("æ’­æ”¾é”™è¯¯ï¼š", err);
            });
            vinyl.style.animationPlayState = "running";
            playPauseBtn.textContent = "âšâš";
        } else {
            audio.pause();
            vinyl.style.animationPlayState = "paused";
            playPauseBtn.textContent = "â–¶";
        }
    });

    // è¿›åº¦æ¡æ›´æ–°
    audio.addEventListener("timeupdate", () => {
        const progress = (audio.currentTime / audio.duration) * 100;
        progressBar.style.width = `${progress}%`;
    });

    // ç‚¹å‡»è¿›åº¦æ¡è·³è½¬æ’­æ”¾ä½ç½®
    progressContainer.addEventListener("click", (e) => {
        const containerWidth = progressContainer.offsetWidth;
        const clickPosition = e.offsetX;
        const progress = (clickPosition / containerWidth) * 100;
        audio.currentTime = (progress / 100) * audio.duration;
        progressBar.style.width = `${progress}%`;
    });

    // ä¸Šä¸€æ›²åŠŸèƒ½
    document.getElementById("prev").addEventListener("click", () => {
        currentSongIndex = (currentSongIndex - 1 + songDatabase.length) % songDatabase.length;
        loadSong(currentSongIndex);
        if (!audio.paused) audio.play();
    });

    // ä¸‹ä¸€æ›²åŠŸèƒ½
    document.getElementById("next").addEventListener("click", () => {
        currentSongIndex = (currentSongIndex + 1) % songDatabase.length;
        loadSong(currentSongIndex);
        if (!audio.paused) audio.play();
    });

    // æ­Œæ›²åˆ—è¡¨ç‚¹å‡»åˆ‡æ¢
    songItems.forEach(item => {
        item.addEventListener("click", () => {
            const index = parseInt(item.getAttribute("data-index"));
            currentSongIndex = index;
            loadSong(index);
            audio.play();
            vinyl.style.animationPlayState = "running";
            playPauseBtn.textContent = "âšâš";
        });
    });

    // åŠ è½½æ­Œæ›²å‡½æ•°
    function loadSong(index) {
        const song = songDatabase[index];
        audio.src = song.src;
        songInfo.innerHTML = `
            <h2>${song.title}</h2>
            <p>ä¸“è¾‘ï¼š${song.album} | æ­Œæ‰‹ï¼š${song.singer}</p>
        `;
        songLyrics.innerHTML = song.lyrics;
        progressBar.style.width = "0%";
        
        // æ›´æ–°æ­Œæ›²åˆ—è¡¨é€‰ä¸­çŠ¶æ€
        songItems.forEach((item, i) => {
            if (i === index) {
                item.classList.add("active");
            } else {
                item.classList.remove("active");
            }
        });
    }

    // éŸ³é¢‘æ’­æ”¾ç»“æŸè‡ªåŠ¨ä¸‹ä¸€æ›²
    audio.addEventListener("ended", () => {
        currentSongIndex = (currentSongIndex + 1) % songDatabase.length;
        loadSong(currentSongIndex);
        audio.play();
    });

    // åˆå§‹åŒ–åŠ è½½ç¬¬ä¸€é¦–æ­Œ
    loadSong(0);

    // å°è¯´é˜…è¯»åŠŸèƒ½ä¿®æ”¹ï¼ˆç›´æ¥åµŒå…¥ã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹å†…å®¹ï¼‰
    function setupBookItems() {
        document.querySelectorAll('.book-item').forEach(item => {
            item.addEventListener('click', () => {
                const bookName = item.getAttribute('data-book');
                const novelContent = document.getElementById('novel-content');
                
                // åˆ‡æ¢åˆ°å°è¯´é¡µé¢
                document.getElementById('bookcase-page').style.display = 'none';
                document.getElementById('novel-page').style.display = 'block';
                
                // å¦‚æœæ˜¯ã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹ï¼Œç›´æ¥åŠ è½½é¢„è®¾å†…å®¹
                if (bookName === 'å¹³å‡¡çš„ä¸–ç•Œ') {
                    // é‡ç½®æ ·å¼
                    novelContent.style.fontSize = '24px';
                    novelContent.style.lineHeight = '2.2';
                    novelContent.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
                    novelContent.style.color = '#333';
                    
                    // åµŒå…¥ã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹ç¬¬ä¸€ç« å†…å®¹
                    novelContent.innerHTML = `
                        <p style="text-align: center; margin: 40px 0; font-weight: bold;">--- ç¬¬ä¸€ç«  ---</p>
                        <p>1975å¹´äºŒã€ä¸‰æœˆé—´ï¼Œä¸€ä¸ªå¹³å¹³å¸¸å¸¸çš„æ—¥å­ï¼Œç»†è’™è’™çš„é›¨ä¸å¤¹ç€ä¸€æ˜ŸåŠç‚¹çš„é›ªèŠ±ï¼Œæ­£çº·çº·æ·‹æ·‹åœ°å‘å¤§åœ°é£˜æ´’ç€ã€‚æ—¶ä»¤å·²å¿«åˆ°æƒŠè›°ï¼Œé›ªå½“ç„¶å†ä¸ä¼šå­˜ç•™ï¼Œå¾€å¾€è¿˜æ²¡ç­‰è½åœ°ï¼Œå°±å·²ç»æ¶ˆå¤±å¾—æ— è¸ªæ— å½±äº†ã€‚é»„åœŸé«˜åŸä¸¥å¯’è€Œæ¼«é•¿çš„å†¬å¤©çœ‹æ¥å°±è¦è¿‡å»ï¼Œä½†é‚£çœŸæ­£æ¸©æš–çš„æ˜¥å¤©è¿˜è¿œè¿œåœ°æ²¡æœ‰åˆ°æ¥ã€‚</p>
                        <p>åœ¨è¿™æ ·é›¨é›ªäº¤åŠ çš„æ—¥å­é‡Œï¼Œå¦‚æœæ²¡æœ‰ä»€ä¹ˆç´§è¦äº‹ï¼Œäººä»¬å®æ„¿ä¸€æ•´å¤©è¶³ä¸å‡ºæˆ·ã€‚å› æ­¤ï¼Œå¿åŸçš„å¤§è¡—å°å··å€’ä¹Ÿæ¯”å¹³æ—¶å°‘äº†è®¸å¤šå˜ˆæ‚ã€‚è¡—å··èƒŒé˜´çš„åœ°æ–¹ã€‚å†¬å¤©æ®‹ç•™çš„ç§¯é›ªå’Œå†°æºœå­æ­£åœ¨é›¨ç‚¹çš„æ•²å‡»ä¸‹èš€åŒ–ï¼ŒçŸ³æ¿è¡—ä¸Šåˆ°å¤„éƒ½æ¼«æµç€è‚®è„çš„æ±¡æ°´ã€‚é£ä¾ç„¶æ˜¯å¯’å†·çš„ã€‚ç©ºè¡è¡çš„è¡—é“ä¸Šï¼Œæœ‰æ—¶ä¼šå¶å°”èµ°è¿‡æ¥ä¸€ä¸ªä¹¡ä¸‹äººï¼Œç ´æ¯¡å¸½æŠ¤ç€è„‘é—¨ï¼Œèƒ³è†Šä¸ŠæŒ½ä¸€ç­å­åœŸè±†æˆ–èåœï¼Œæœ‰æ°”æ— åŠ›åœ°å‘¼å”¤ç€ä¹°ä¸»ã€‚å”‰ï¼ŒåŸå¸‚åœ¨è¿™æ ·çš„æ—¥å­é‡Œå®Œå…¨ä¸§å¤±äº†ç”Ÿæ°”ï¼Œå˜å¾—æ²¡æœ‰ä¸€ç‚¹å¯çˆ±ä¹‹å¤„äº†ã€‚</p>
                        <p>åªæœ‰åœ¨åŠå±±è…°å¿ç«‹é«˜ä¸­çš„å¤§é™¢åé‡Œï¼Œæ­¤åˆ»å´è‡ªæœ‰ä¸€ç•ªçƒ­é—¹æ™¯è±¡ã€‚åˆé¥­é“ƒå£°åˆšåˆšå“è¿‡ï¼Œä»ä¸€æ’æ’é«˜ä½é”™è½çš„çŸ³çª‘æ´é‡Œï¼Œå°±è·‘å‡ºæ¥äº†ä¸€ç¾¤ä¸€ä¼™çš„ç”·ç”·å¥³å¥³ã€‚ä»–ä»¬æŠŠç¢—ç­·æ•²å¾—éœ‡å¤©ä»·å“ï¼Œè¸æ³¥å¸¦æ°´ã€å«å«åš·åš·åœ°è·‘è¿‡é™¢åï¼Œå‘å—é¢æ€»åŠ¡å¤„é‚£ä¸€æ’çª‘æ´çš„å¢™æ ¹ä¸‹èœ‚æ¶Œè€Œå»ã€‚åŒå¤§ä¸€ä¸ªé™¢å­ï¼Œéœæ—¶å°±è¢«è¿™çº·ä¹±çš„äººç¾¤è¸©è¸æˆäº†ä¸€ç‰‡çƒ‚æ³¥æ»©ã€‚ä¸æ­¤åŒæ—¶ï¼Œé‚£äº›å®¶åœ¨æœ¬åŸçš„èµ°è¯»ç”Ÿä»¬ï¼Œä¹Ÿæ­£ä¸‰ä¸‰ä¸¤ä¸¤æ¶Œå‡ºä¸œé¢å­¦æ ¡çš„å¤§é—¨ã€‚ä»–ä»¬æ’‘ç€é›¨ä¼ï¼Œä¸€è·¯è¯´è¯´ç¬‘ç¬‘ï¼Œé€šè¿‡ä¸€æ®µæ—©å¹´é—´ç”¨æ¨ªçŸ³ç‰‡æ’èµ·çš„é•¿é•¿çš„ä¸‹å¡è·¯ï¼Œä¸å¤šæ—¶ä¾¿çº·çº·æ¶ˆå¤±åœ¨åŸå¸‚çš„å¤§è¡—å°å··ä¸­ã€‚</p>
                        <p>åœ¨æ ¡å›­å†…çš„å—å¢™æ ¹ä¸‹ï¼Œç°åœ¨å·²ç»æŒ‰ç­çº§æ’èµ·äº†åå‡ è·¯çºµé˜Ÿã€‚å„ç­çš„å€¼æ—¥ç”Ÿæ­£åœ¨å¿™ç¢Œåœ°ç»™ä¼—äººåˆ†é¥­èœã€‚æ¯ä¸ªäººçš„é¥­èœéƒ½æ˜¯æ˜¨å¤©ç™»è®°å¥½å¹¶ä»˜äº†é¥­ç¥¨çš„ï¼Œå› æ­¤ç¨‹åºå¹¶ä¸å¤æ‚ï¼Œç°åœ¨å€¼æ—¥ç”Ÿåªæ˜¯æŒ‰é¥­è¡¨ä»˜ç»™æ¯äººé¢„è®¢çš„ä¸€ä»½ã€‚èœåˆ†ç”²ã€ä¹™ã€ä¸™ä¸‰ç­‰ã€‚ç”²èœä»¥åœŸè±†ã€ç™½èœã€ç²‰æ¡ä¸ºä¸»ï¼Œé‡Œé¢æœ‰äº›å«äººå˜´é¦‹çš„å¤§è‚‰ç‰‡ï¼Œæ¯ä»½ä¸‰æ¯›é’±ï¼›ä¹™èœå…¶å®ƒå†…å®¹å’Œç”²èœä¸€æ ·ï¼Œåªæ˜¯æ²¡æœ‰è‚‰ï¼Œæ¯ä»½ä¸€æ¯›äº”åˆ†é’±ã€‚ä¸™èœå¯å°±å·®è¿œäº†ï¼Œæ¸…æ°´ç…®ç™½èåœâ€”â€”ä¼¼ä¹åªæ˜¯ä¸ºäº†æ©é¥°è¿™è¿‡åˆ†çš„æ¸…æ·¡ï¼Œæ‰åœ¨é‡Œé¢è±¡å¾æ€§åœ°æ¼‚äº†å‡ ç‚¹è¾£å­æ²¹èŠ±ã€‚ä¸è¿‡ï¼Œè¿™èœä»·é’±å€’ä¹Ÿä¾¿å®œï¼Œæ¯ä»½äº”åˆ†é’±ã€‚</p>
                        <p>å„ç­çš„ç”²èœåªæ˜¯åœ¨å°è„¸ç›†é‡Œç››ä¸€ç‚¹ï¼Œçœ‹æ¥åƒå¾—èµ·è‚‰èœçš„å­¦ç”Ÿæ²¡æœ‰å‡ ä¸ªã€‚ä¸™èœä¹Ÿç”¨å°è„¸ç›†ç››ä¸€ç‚¹ï¼Œè¯´æ˜åƒè¿™ç§ä¸‹ç­‰ä¼™é£Ÿçš„äººä¹Ÿæ²¡æœ‰å¤šå°‘ã€‚åªæœ‰ä¹™èœå„ç­éƒ½ç”¨çƒ§ç“·å¤§è„šç›†ç››ç€ï¼Œæµ·æµ·æ¼«æ¼«çš„ï¼Œæ˜¾ç„¶å¤§éƒ¨åˆ†äººéƒ½åƒè¿™ç§æ—¢ä¸å¥¢ä¾ˆä¹Ÿä¸å¯’é…¸çš„èœã€‚ä¸»é£Ÿä¹Ÿåˆ†ä¸‰ç­‰ï¼šç™½é¢é¦ï¼Œç‰ç±³é¢é¦ï¼Œé«˜ç²±é¢é¦ï¼›ç™½ã€é»„ã€é»‘ï¼Œé¢œè‰²å°±è¡¨æ˜äº†ä¸€ç§å·®åˆ«ï¼›å­¦ç”Ÿä»¬æˆç§°æ¬§æ´²ã€äºšæ´²ã€éæ´²ã€‚</p>
                        <p>ä»æ’é˜Ÿçš„è¿™ä¸€ç‰‡é»‘é¸¦é¸¦çš„äººç¾¤çœ‹æ¥ï¼Œä»–ä»¬å¤§éƒ¨åˆ†éƒ½æ¥è‡ªå†œæ‘ï¼Œè„¸ä¸Šå’Œèº«ä¸Šæˆ–å¤šæˆ–å°‘éƒ½ç•™æœ‰ä½“åŠ›åŠ³åŠ¨çš„ç—•è¿¹ã€‚é™¤è¿‡ä¸ªæŠŠäººçš„è¡£è£…å’Œä»–ä»¬çš„å†œæ°‘å®¶é•¿ä¸€æ ·åœŸæ°”å¤–ï¼Œè¿™äº›å·²è¢«è‡ªå·±çš„çˆ¶è¾ˆçœ‹ä½œæ˜¯"å…ˆç”Ÿ"çš„äººï¼Œç©¿æˆ´éƒ½è¿˜ç®—ä½“é¢ã€‚è´«å›°å±±åŒºçš„å†œæ°‘å°½ç®¡çœ¼ä¸‹å¤§éƒ½å°‘åƒç¼ºç©¿ï¼Œä½†å­©å­æ—¢ç„¶åˆ°å¤§åœ°æ–¹å»å¿µä¹¦ï¼Œå®¶é•¿ä»¬å°±æ˜¯å’¬ç€ç‰™å…³çœåƒèŠ‚ç”¨ï¼Œä¹Ÿè¦ç»™ä»–ä»¬åšå‡ ä»¶è§äººè¡£è£³ã€‚å½“ç„¶ï¼Œè¿™é˜Ÿä¼é‡Œçœ‹æ¥ä¹Ÿæœ‰ä¸ªæŠŠå…‰æ™¯å¥½çš„å†œå®¶å­å¼Ÿï¼Œé‚£ç©¿æˆ´å·²ç»å’ŒåŸé‡Œå¹²éƒ¨ä»¬çš„å­å¼Ÿæ²¡ä»€ä¹ˆå·®åˆ«ï¼Œè€Œä¸”èƒ³è†Šè…•ä¸Šå¾€å¾€è¿˜æ’‘ä¸€å—æ˜æ™ƒæ™ƒçš„æ‰‹è¡¨ã€‚æœ‰äº›è¿™æ ·çš„"æ´‹äºº"å°±ç«™åœ¨å¤§ä¼—ä¹‹é—´ï¼Œå¦‚åŒé¹¤ç«‹é¸¡ç¾¤ï¼Œæ¯«ä¸æ©é¥°è‡ªå·±çš„ä¼˜è¶Šæ„Ÿã€‚ä»–ä»¬æ’åœ¨éå‡¡çš„ç”²èœç›†åé¢ï¼Œè™½ç„¶äººæ•°å¯¥å¯¥æ— å‡ ï¼Œä½†å´ç‰¹åˆ«æƒ¹çœ¼ã€‚</p>
                        <p>åœ¨æ•´ä¸ªè’å‡‰è€Œè´«ç˜ çš„é»„åœŸé«˜åŸï¼Œä¸€ä¸ªå¿çš„å¿ç«‹é«˜ä¸­ï¼Œå°±ç®—æ˜¯æœ¬å¿çš„æœ€é«˜å­¦åºœå§ï¼Œä¹Ÿæ— è®ºå¦‚ä½•ä¸å¯èƒ½ç»™å­¦ç”Ÿä»¬ç›–ä¸€åº§é¤å…ã€‚å¤©å¥½å¤©åï¼Œå¤§å®¶éƒ½æ˜¯éœ²å¤©å°±é¤ã€‚å¥½åœ¨è¿™äº›é’å¹´éƒ½æ¥è‡ªå±±ä¹¡åœªå´‚ï¼Œè°æ²¡åœ¨é‡å±±é‡åœ°é‡Œåƒè¿‡é¥­å‘¢ï¼Ÿå› æ­¤å¤§å®¶ä¹Ÿå¹¶ä¸åœ¨ä¹è¿™ç§äº‹ã€‚é€šå¸¸å¤©æ°”å¥½çš„æ—¶å€™ï¼Œå¤§å®¶éƒ½å„è‡ªå’Œè¦å¥½çš„åŒå­¦è¹²æˆä¸€åœˆï¼Œè¯´ç€ç¬‘ç€å°±æŠŠé¥­åƒå®Œäº†ã€‚</p>
                        <p>ä»Šå¤©å¯ä¸è¡Œã€‚æ‰€æœ‰æ‰“äº†é¥­èœçš„äººã€‚éƒ½ç”¨è‰å¸½æˆ–èƒ³è†Šè‚˜æŠ¤ç€ç¢—ï¼Œè¶”è¶”è¶„è¶„ç©¿è¿‡çƒ‚æ³¥å¡˜èˆ¬çš„é™¢åï¼Œè·‘å›è‡ªå·±çš„å®¿èˆå»äº†ã€‚ä¸å¤§ä¸€ä¼šåŠŸå¤«ï¼Œé¥­åœºä¸Šå°±ç¨€ç¨€è½è½çš„æ²¡æœ‰å‡ ä¸ªäººäº†ã€‚å¤§éƒ¨åˆ†ç­çº§çš„å€¼æ—¥ç”Ÿä¹Ÿéƒ½å…ˆåèµ°äº†ã€‚</p>
                        <p>ç°åœ¨ï¼Œåªæœ‰é«˜ä¸€ã€ˆ1ã€‰ç­çš„å€¼æ—¥ç”Ÿä¸€ä¸ªäººç•™åœ¨ç©ºæ— äººè¿¹çš„é¥­åœºä¸Šã€‚è¿™æ˜¯ä¸€ä½çŸ®çŸ®èƒ–èƒ–çš„å¥³ç”Ÿï¼Œå¤§æ¦‚æ˜¯å°æ—¶å€™å¾—è¿‡å°å„¿éº»ç—¹ä¸€ç±»çš„ç—…ï¼Œç•™ä¸‹äº†ç—¼ç–¾ï¼Œå› æ­¤è¡Œèµ°æœ‰ç‚¹ç˜¸è·›ã€‚å¥¹é¢å‰çš„ä¸‰ä¸ªèœç›†é‡Œå·²ç»æ²¡æœ‰äº†èœï¼Œé¦ç­é‡Œä¹Ÿåªå‰©äº†å››ä¸ªç„¦é»‘çš„é«˜ç²±é¢é¦ã€‚çœ‹æ¥è¿™å‡ ä¸ªé»‘å®¶ä¼™ä¸æ˜¯å€¼æ—¥ç”Ÿæœ¬äººçš„ï¼Œå› ä¸ºå¥¹è‡ªå·±æ‰‹é‡Œæ‹¿ç€ä¸€ä¸ªç™½é¢é¦å’Œä¸€ä¸ªç‰ç±³é¢é¦ï¼Œç¢—é‡Œä¹Ÿè±¡æ˜¯ä¹™èœã€‚è¿™è¯´æ˜è·›å¥³å­ç®—å¾—ä¸Šä¸­ç­‰äººå®¶ã€‚å¥¹ç«¯ç€è‡ªå·±çš„é¥­èœï¼Œæ»¡è„¸ä¸é«˜å…´åœ°ç«‹åœ¨æˆ¿æªä¸‹ï¼Œæ˜¾ç„¶æ˜¯ç­‰å¾…æœ€åä¸€ä¸ªè·šè·šæ¥è¿Ÿè€…â€”â€”æˆ‘ä»¬å¯ä»¥æƒ³æ¥è¿™å¿…å®šæ˜¯ä¸€ä¸ªç©·å°å­ï¼Œä»–ä¸ä»…åƒè¿™æœ€å·®çš„ä¸»é£Ÿï¼Œè€Œä¸”è¿äº”åˆ†é’±çš„ä¸™èœä¹Ÿä¹°ä¸èµ·ä¸€ä»½å•Šï¼</p>
                        <p>é›¨ä¸­çš„é›ªèŠ±é™¡ç„¶é—´å¢å¤šäº†ï¼Œè¿œè¿œè¿‘è¿‘æ„ˆåŠ å˜å¾—æ¨¡æ¨¡ç³Šç³Šã€‚åŸå¸‚å¯‚é™æ— å£°ã€‚éšçº¦åœ°å¬è§å¾ˆè¿œçš„åœ°æ–¹ä¼ æ¥ä¸€å£°å…¬é¸¡çš„å•¼é¸£ï¼Œç»™è¿™ç°è’™è’™çš„å¤©åœ°é—´å¹³æ·»äº†ä¸€ä¸ç¡æ¢¦èˆ¬çš„é˜´éƒã€‚</p>
                        <p>å°±åœ¨è¿™æ—¶å€™ï¼Œåœ¨ç©ºæ—·çš„é™¢åçš„åŒ—å¤´ï¼Œèµ°è¿‡æ¥ä¸€ä¸ªç˜¦é«˜ä¸ªçš„é’å¹´äººã€‚ä»–èƒ³è†Šçªé‡Œå¤¹ç€ä¸€åªç¢—ï¼Œç¼©ç€è„–å­åœ¨æ³¥åœ°é‡Œè¹’è·šè€Œè¡Œã€‚å°ä¼™å­è„¸è‰²é»„ç˜¦ï¼Œè€Œä¸”ä¸¤é¢Šæœ‰ç‚¹å¡Œé™·ï¼Œæ˜¾å¾—é¼»å­è±¡å¸Œè…Šäººä¸€æ ·åˆé«˜åˆç›´ã€‚è„¸ä¸Šçœ‹æ¥æ‰åˆšåˆšè¤ªæ‰å°‘å¹´çš„ç¨šæ°”â€”â€”æ˜¾ç„¶ç”±äºè¥å…»ä¸è‰¯ï¼Œè¿˜æ²¡æœ‰ç„•å‘å‡ºä»–è¿™ç§å¹´é¾„æ‰€ç‰¹æœ‰çš„é‚£ç§é’æ˜¥å…‰å½©ã€‚</p>
                        <p>ä»–æ’©å¼€ä¸¤æ¡ç˜¦é•¿çš„è…¿ï¼Œæ‰‘è¸æ‰‘è¸åœ°è¸©ç€æ³¥æ°´èµ°ç€ã€‚è¿™ä¹Ÿè®¸å°±æ˜¯é‚£å‡ ä¸ªé»‘é¢é¦çš„ä¸»äººï¼Ÿçœ‹ä»–é‚£ä¸€èº«å¯æ€œçš„ç©¿æˆ´æƒ³å¿…ä¹Ÿåªèƒ½åƒè¿™ç§ä¼™é£Ÿã€‚ç§å§ï¼Œä»–é‚£èº«è¡£æœå°½ç®¡å¼æ ·è£å‰ªå¾—å‹‰å¼ºè¿˜ç®—æ˜¯å­¦ç”Ÿè£…ï¼Œä½†åˆ†æ˜æ˜¯è‡ªå®¶ç»‡å‡ºçš„é‚£ç§è€åœŸç²—å¸ƒï¼Œè€Œä¸”é»‘é¢œæ–™æŸ“å¾—å¾ˆä¸å‡åŒ€ï¼Œç»™äººä¸€ç§è‚®è‚®è„è„çš„æ„Ÿè§‰ã€‚è„šä¸Šçš„ä¸€åŒæ—§é»„èƒ¶é‹å·²ç»æ²¡æœ‰äº†é‹å¸¦ï¼Œå‡‘åˆç€ç³»ä¸¤æ ¹ç™½çº¿ç»³ï¼›ä¸€åªé‹å¸®ä¸Šç”šè‡³è¿˜ç¼€è¡¥ç€ä¸€å—è“å¸ƒè¡¥å®è£¤å­æ˜¾ç„¶æ˜¯å‰ä¸¤å¹´ç¼çš„ï¼Œäººé•¿å¸ƒç¼©ï¼Œç°åœ¨å·²ç»çŸ­çª„å¾—åŠåœ¨äº†åŠè…¿æŠŠä¸Šï¼›å¹¸äºè¢œè…°é«˜ï¼Œå¦åˆ™å°±è¦éœ²è‚‰äº†ã€‚ï¼ˆå¯æ˜¯é™¤è¿‡ä»–è‡ªå·±ï¼Œè°åˆèƒ½çŸ¥é“ï¼Œä»–é‚£ä¸¤åªçº¿è¢œå­æ—©å·²ç»æ²¡æœ‰äº†åè·Ÿï¼Œåªæ˜¯ç”±äºé‹çš„é®æ©ï¼Œæ‰ä½¿äººè§‰å¾—é‚£è¢œå­æ˜¯å®Œå¥½æ— ç¼ºçš„ï¼‰ã€‚</p>
                        <p>ä»–å¾„ç›´å‘é¥­åœºèµ°è¿‡æ¥äº†ã€‚ç°åœ¨å¯ä»¥æ–­å®šï¼Œä»–å°±æ˜¯æ¥æ‹¿è¿™å‡ ä¸ªé»‘é¢é¦çš„ã€‚è·›å¥³å­åœ¨ä»–æœªåˆ°é¦ç­ä¹‹å‰ï¼Œå°±æ—©å·²ç»è¿«ä¸åŠå¾…åœ°ç«¯ç€è‡ªå·±çš„é¥­ç¢—ä¸€ç˜¸ä¸€è·›åœ°ç¦»å¼€äº†ã€‚</p>
                        <p>ä»–ç‹¬ä¸ªå„¿æ¥åˆ°é¦ç­å‰ï¼Œå…ˆæ€”äº†ä¸€ä¸‹ï¼Œç„¶åä¾¿å¼¯è…°æ‹¾äº†ä¸¤ä¸ªé«˜ç²±é¢é¦ã€‚ç­é‡Œè¿˜å‰©ä¸¤ä¸ªï¼Œä¸çŸ¥ä»–ä¸ºä»€ä¹ˆæ²¡æœ‰æ‹¿ã€‚</p>
                        <p>ä»–ç›´èµ·èº«å­æ¥ï¼Œçœ¼ç›ä¸ç”±åœ°æœä¸‰åªç©ºè¡è¡çš„èœç›†é‡Œç¥äº†ä¸€çœ¼ã€‚ä»–ç§è§ä¹™èœç›†çš„åº•å­ä¸Šè¿˜æœ‰ä¸€ç‚¹æ®‹æ±¤å‰©æ°´ã€‚æˆ¿ä¸Šçš„æªæ°´æ»´ç­”ä¸‹æ¥ï¼Œç›†åº•ä¸Šçš„èœæ±¤å››å¤„é£æº…ã€‚ä»–æ‰­å¤´ç§äº†ç§ï¼šé›¨é›ªè¿·è’™çš„å¤§é™¢åé‡Œç©ºæ— ä¸€äººã€‚ä»–å¾ˆå¿«è¹²ä¸‹æ¥ï¼Œæ…Œå¾—å¦‚åŒå·çªƒä¸€èˆ¬ï¼Œç”¨å‹ºå­æŠŠç›†åº•ä¸Šæ··åˆç€é›¨æ°´çš„å‰©èœæ±¤å¾€è‡ªå·±çš„ç¢—é‡Œèˆ€ã€‚é“å‹ºåˆ®ç›†åº•çš„å˜¶å•¦å£°è±¡ç‚¸å¼¹çš„çˆ†ç‚¸å£°ä¸€æ ·ä»¤äººæƒŠå¿ƒã€‚è¡€æ¶Œä¸Šäº†ä»–é»„ç˜¦çš„è„¸ã€‚ä¸€æ»´å¾ˆå¤§çš„æªæ°´è½åœ¨ç›†åº•ï¼Œæº…äº†ä»–ä¸€è„¸èœæ±¤ã€‚ä»–é—­ä½çœ¼ï¼Œç´§æ¥ç€ï¼Œå°±è§ä¸¤é¢—æ³ªç æ…¢æ…¢åœ°ä»è„¸é¢Šä¸Šæ»‘è½äº†ä¸‹æ¥â€”â€”å”‰ï¼Œæˆ‘ä»¬å§‘ä¸”å°±è®¤ä¸ºè¿™æ˜¯ä»–çœ¼ä¸­æº…è¿›äº†è¾£å­æ±¤å§ï¼</p>
                        <p>ä»–ç«™èµ·æ¥ï¼Œç”¨æ‰‹æŠ¹äº†ä¸€æŠŠè„¸ï¼Œç«¯ç€åŠç¢—å‰©èœæ±¤ï¼Œæ¥åˆ°è¥¿å—æ‹è§’å¤„çš„å¼€æ°´æˆ¿å‰ï¼Œåœ¨æ°´æˆ¿åå¢™ä¸Šä¼¸å‡ºæ¥çš„ç®¡å­ä¸Šç»™èœæ±¤é‡Œæ€äº†ä¸€äº›å¼€æ°´ï¼Œç„¶åæŠŠé«˜ç²±é¢é¦æ°ç¢æ³¡è¿›å»ï¼Œå°±è¹²åœ¨æˆ¿æªä¸‹ç‹¼åè™å’½åœ°åƒèµ·æ¥ã€‚</p>
                        <p>ä»–çªç„¶åœæ­¢äº†å’€åš¼ï¼Œç„¶åçœ‹ç€ä¸€ä½å¥³ç”Ÿæ¥åˆ°é¦ç­å‰ï¼ŒæŠŠå‰©ä¸‹çš„é‚£ä¸¤ä¸ªé»‘é¢é¦æ‹¿èµ°äº†ã€‚æ˜¯çš„ï¼Œå¥¹ä¹Ÿæ¥äº†ã€‚ä»–æœ›ç€å¥¹ç¦»å»çš„ã€ç©¿ç ´è¡£è£³çš„èƒŒå½±ï¼Œæ€”äº†å¥½ä¸€ä¼šã€‚</p>
                        <p>è¿™å‡ ä¹æˆäº†ä¸€ä¸ªæƒ¯ä¾‹ï¼šè‡ªä»å¼€å­¦ä»¥æ¥ï¼Œæ¯æ¬¡åƒé¥­çš„æ—¶å€™ï¼Œç­ä¸Šæ€»æ˜¯ä»–ä¸¤ä¸ªæœ€åæ¥ï¼Œé»˜é»˜åœ°å„è‡ªæ‹¿èµ°è‡ªå·±çš„ä¸¤ä¸ªé»‘é«˜ç²±é¢é¦ã€‚è¿™å¹¶ä¸æ˜¯çº¦å®šçš„ï¼Œä»–ä»¬å®é™…ä¸Šè¿˜å¹¶ä¸ç†Ÿæ‚‰ï¼Œç”šè‡³è¿ä¸€å¥è¯ä¹Ÿæ²¡è¯´è¿‡ã€‚ä»–ä»¬éƒ½æ˜¯åˆšåˆšä»å„å…¬ç¤¾ä¸­å­¦æ¯•ä¸šåï¼Œè¢«æ¨èæ¥å¿åŸä¸Šé«˜ä¸­çš„ã€‚å¼€å­¦æ²¡æœ‰å¤šå°‘å¤©ï¼Œç­ä¸Šå¤§éƒ¨åˆ†åŒå­¦ç›¸äº’ä¹‹é—´é™¤è¿‡å’ŒåŒæ‘åŒæ ¡æ¥çš„åŒå­¦ç†Ÿæ‚‰å¤–ï¼Œç”Ÿäººä¹‹é—´è¿˜æ²¡æœ‰ä»€ä¹ˆäº¤å¾€ã€‚</p>
                        <p>ä»–è¹²åœ¨æˆ¿æªä¸‹ï¼Œä¸€è¾¹å¾€å˜´é‡Œæ‰’æ‹‰é¥­ï¼Œä¸€è¾¹åœ¨å¿ƒé‡ŒçŒœæµ‹ï¼šå¥¹ä¹‹æ‰€ä»¥ä¹Ÿå¸¸å¸¸æœ€åæ¥å–é¥­ï¼ŒåŸå› å¤§æ¦‚å’Œä»–ä¸€æ ·ã€‚æ˜¯çš„ï¼Œæ­£æ˜¯å› ä¸ºè´«ç©·ï¼Œå› ä¸ºåƒä¸èµ·å¥½é¥­ï¼Œå› ä¸ºå¹´è½»è€Œæ•æ„Ÿçš„è‡ªå°Šå¿ƒï¼Œæ‰ä½¿ä»–ä»¬èº²é¿å…¬ä¼—çš„ç›®å…‰æ¥æ‚„ç„¶åœ°å–èµ°è‡ªå·±é‚£ä¸¤ä¸ªä¸ä½“é¢çš„é»‘å®¶ä¼™ï¼Œä»¥å…é­å—è®¸å¤šæ— è¨€çš„è€»ç¬‘ï¼</p>
                        <p>ä½†ä»–å¯¹å¥¹çš„ä¸€åˆ‡æ¯«æ— æ‰€çŸ¥ã€‚å› ä¸ºç­ä¸Šä¸€å¤©ç‚¹ä¸€æ¬¡åï¼Œä»–ç°åœ¨åªçŸ¥é“å¥¹çš„åå­—å«éƒçº¢æ¢…ã€‚</p>
                        <p>å¥¹å¤§æ¦‚ä¹ŸåªçŸ¥é“ä»–çš„åå­—å«å­™å°‘å¹³å§ï¼Ÿ</p>
                    `;
                } else {
                    // å…¶ä»–ä¹¦ç±ä»æ˜¾ç¤ºåŠ è½½æç¤ºï¼ˆå¯æ ¹æ®éœ€è¦æ‰©å±•ï¼‰
                    novelContent.innerHTML = `
                        <h2>${bookName}</h2>
                        <p>è¯¥ä¹¦ç±å†…å®¹æ­£åœ¨æ•´ç†ä¸­ï¼Œæ•¬è¯·æœŸå¾…</p>
                    `;
                }
            });
        });
    }

    // æ–°å¢å­—ä½“å¤§å°è°ƒæ•´åŠŸèƒ½
    function changeFontSize(change) {
        const novelContent = document.getElementById('novel-content');
        const currentSize = parseInt(window.getComputedStyle(novelContent).fontSize);
        // é™åˆ¶å­—ä½“å¤§å°èŒƒå›´ï¼ˆé€‚åˆè€å¹´äººé˜…è¯»ï¼‰
        const newSize = Math.max(20, Math.min(36, currentSize + change));
        novelContent.style.fontSize = `${newSize}px`;
    }

    // æ–°å¢å¤œé—´æ¨¡å¼åˆ‡æ¢åŠŸèƒ½
    let isNightMode = false;
    function toggleNightMode() {
        const novelContent = document.getElementById('novel-content');
        isNightMode = !isNightMode;
        
        if (isNightMode) {
            novelContent.style.backgroundColor = 'rgba(30, 30, 40, 0.95)';
            novelContent.style.color = '#e0e0e0';
        } else {
            novelContent.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
            novelContent.style.color = '#333';
        }
    }

    // å¯¹è¯é¡µé¢åŠŸèƒ½
    // è§†é¢‘é…ç½®
    const videoConfig = {
        'å„¿åª³': './videos/å„¿åª³.mp4',
        'å„¿å­': './videos/å„¿å­.mp4',
        'å­™å¥³': './videos/å­™å¥³.mp4',
        'å­™å­': './videos/å­™å­.mp4'
    };

    // å£°éŸ³é…ç½®
    const voiceConfig = {
        'å„¿åª³': 'daughter',
        'å„¿å­': 'son',
        'å­™å¥³': 'daughter',
        'å­™å­': 'son'
    };

    // è§†é¢‘å…ƒç´ 
    const avatarVideo = document.getElementById('avatar-video');
    const stopConversationBtn = document.getElementById('stop-conversation');
    
    // è§†é¢‘åŒæ­¥ä¼˜åŒ–
    if (avatarVideo) {
        avatarVideo.addEventListener('loadeddata', function() {
            console.log('è§†é¢‘å·²åŠ è½½å®Œæˆ');
            // é¢„åŠ è½½è§†é¢‘ä»¥å‡å°‘å»¶è¿Ÿ
            this.muted = true;
            this.play().then(() => {
                this.pause();
                this.currentTime = 0;
                this.muted = false;
                console.log('è§†é¢‘é¢„åŠ è½½å®Œæˆ');
            }).catch(e => console.log('é¢„åŠ è½½è§†é¢‘æ—¶å‡ºé”™:', e));
        });

        // è§†é¢‘æ’­æ”¾çŠ¶æ€ç›‘å¬
        avatarVideo.addEventListener('play', function() {
            console.log('è§†é¢‘å¼€å§‹æ’­æ”¾');
        });

        avatarVideo.addEventListener('pause', function() {
            console.log('è§†é¢‘æš‚åœ');
        });

        // æ·»åŠ è§†é¢‘å¾ªç¯æ’­æ”¾
        avatarVideo.addEventListener('ended', function() {
            if (isSpeaking) {
                this.currentTime = 0;
                this.play();
            }
        });
    }

    // å¼€å§‹å¯¹è¯å‡½æ•°
    function startConversation(gender, person) {
        // æ˜¾ç¤ºé€‰æ‹©æç¤º
        const tip = document.getElementById('gender-tip');
        if (tip) {
            tip.textContent = `å·²é€‰æ‹©${person}(${gender === 'son' ? 'ç”·å£°' : 'å¥³å£°'})`;
            tip.style.display = 'block';
            console.log(`é€‰æ‹©äººç‰©: ${person}, æ€§åˆ«: ${gender}`); // æ·»åŠ è°ƒè¯•ä¿¡æ¯
            // 3ç§’åéšè—æç¤º
            setTimeout(() => {
                tip.style.display = 'none';
            }, 3000);
        }
        
        // è®¾ç½®è§†é¢‘æº
        if (avatarVideo && videoConfig[person]) {
            // æ¸…é™¤ç°æœ‰æº
            while (avatarVideo.firstChild) {
                avatarVideo.removeChild(avatarVideo.firstChild);
            }
            // æ·»åŠ æ–°çš„è§†é¢‘æº
            const source = document.createElement('source');
            source.src = videoConfig[person];
            source.type = 'video/mp4';
            avatarVideo.appendChild(source);
            avatarVideo.load(); // é‡æ–°åŠ è½½è§†é¢‘
            console.log(`è§†é¢‘æºå·²è®¾ç½®ä¸º: ${videoConfig[person]}`);
        }
        
        // å‘é€è¯·æ±‚åˆ°åç«¯è®¾ç½®å£°éŸ³æ€§åˆ«
        const voiceGender = voiceConfig[person] || gender;
        console.log(`å‘é€è¯·æ±‚åˆ°åç«¯: gender=${voiceGender}, person=${person}`);
        fetch('http://localhost:5001/set_voice_gender', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({gender: voiceGender, person: person})
        })
        .then(response => {
            console.log('åç«¯å“åº”çŠ¶æ€:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('å£°éŸ³è®¾ç½®ç»“æœ:', data);
            if (data.success) {
                // è®¾ç½®æˆåŠŸåï¼Œå¼€å§‹è¯­éŸ³è¯†åˆ«
                startVoiceRecognition();
            } else {
                console.error('å£°éŸ³è®¾ç½®å¤±è´¥:', data.message);
                // å³ä½¿è®¾ç½®å¤±è´¥ï¼Œä»ç„¶å¯ä»¥å¼€å§‹è¯­éŸ³è¯†åˆ«
                startVoiceRecognition();
            }
        })
        .catch(error => {
            console.error('è®¾ç½®å£°éŸ³æ—¶å‡ºé”™:', error);
            // å³ä½¿ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œä»ç„¶å¯ä»¥å¼€å§‹è¯­éŸ³è¯†åˆ«
            startVoiceRecognition();
        });
    }

    // å¼€å§‹è¯­éŸ³è¯†åˆ«
    function startVoiceRecognition() {
        console.log('æ­£åœ¨å¯åŠ¨è¯­éŸ³è¯†åˆ«...');
        fetch('http://localhost:5001/start_recognition', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => {
            console.log('æ”¶åˆ°æœåŠ¡å™¨å“åº”:', response.status);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('è¯­éŸ³è¯†åˆ«å“åº”æ•°æ®:', data);
            if (data.success) {
                console.log('è¯­éŸ³è¯†åˆ«å·²å¯åŠ¨:', data.message);
                // è·³è½¬åˆ°è§†é¢‘é¡µé¢
                document.getElementById('dialog-page').style.display = 'none';
                document.getElementById('video-page').style.display = 'block';
                console.log('å·²åˆ‡æ¢åˆ°è§†é¢‘é¡µé¢');
                
                // ç¡®ä¿è§†é¢‘å¼€å§‹æ’­æ”¾
                ensureVideoPlays();
                
                // å¼€å§‹å®šæœŸæ£€æŸ¥è¯­éŸ³çŠ¶æ€
                checkVoiceStatus();
            } else {
                console.error('å¯åŠ¨è¯­éŸ³è¯†åˆ«å¤±è´¥:', data.message);
            }
        })
        .catch(error => {
            console.error('å¯åŠ¨è¯­éŸ³è¯†åˆ«æ—¶å‡ºé”™:', error);
        });
    }

    // ç¡®ä¿è§†é¢‘æ’­æ”¾
    function ensureVideoPlays() {
        if (avatarVideo) {
            console.log('å°è¯•æ’­æ”¾è§†é¢‘...');
            // å°è¯•æ’­æ”¾è§†é¢‘
            const playPromise = avatarVideo.play();
            
            if (playPromise !== undefined) {
                playPromise
                    .then(() => {
                        console.log('è§†é¢‘å¼€å§‹æ’­æ”¾æˆåŠŸ');
                    })
                    .catch(error => {
                        console.log('è§†é¢‘è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', error);
                        // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œæ˜¾ç¤ºæç¤ºè®©ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»
                        showPlayPrompt();
                    });
            }
        }
    }

    // æ˜¾ç¤ºæ’­æ”¾æç¤º
    function showPlayPrompt() {
        const playPrompt = document.createElement('div');
        playPrompt.id = 'play-prompt';
        playPrompt.style.position = 'absolute';
        playPrompt.style.top = '50%';
        playPrompt.style.left = '50%';
        playPrompt.style.transform = 'translate(-50%, -50%)';
        playPrompt.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
        playPrompt.style.color = 'white';
        playPrompt.style.padding = '20px';
        playPrompt.style.borderRadius = '10px';
        playPrompt.style.zIndex = '100';
        playPrompt.style.textAlign = 'center';
        playPrompt.innerHTML = '<p>ç‚¹å‡»æ’­æ”¾è§†é¢‘</p><button id="manual-play-btn" style="padding: 10px 20px; font-size: 18px; margin-top: 10px;">æ’­æ”¾</button>';
        
        document.querySelector('.video-container').appendChild(playPrompt);
        
        document.getElementById('manual-play-btn').addEventListener('click', function() {
            avatarVideo.play();
            playPrompt.remove();
        });
    }

    // åœæ­¢è¯­éŸ³è¯†åˆ«
    function stopVoiceRecognition() {
        fetch('http://localhost:5001/stop_recognition', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            console.log('è¯­éŸ³è¯†åˆ«å·²åœæ­¢:', data.message);
        })
        .catch(error => {
            console.error('åœæ­¢è¯­éŸ³è¯†åˆ«æ—¶å‡ºé”™:', error);
        });
    }

    // æ£€æŸ¥è¯­éŸ³çŠ¶æ€å¹¶æ§åˆ¶è§†é¢‘æ’­æ”¾
    let speakingInterval = null;

    function checkVoiceStatus() {
        fetch('http://localhost:5001/get_status')
        .then(response => response.json())
        .then(data => {
            console.log('è¯­éŸ³çŠ¶æ€æ£€æŸ¥ç»“æœ:', data);
            if (data.success) {
                // æ§åˆ¶è§†é¢‘æ’­æ”¾çŠ¶æ€
                if (data.is_speaking && !isSpeaking) {
                    // å¼€å§‹è¯´è¯ï¼Œæ’­æ”¾è§†é¢‘
                    isSpeaking = true;
                    if (avatarVideo) {
                        avatarVideo.muted = false; // å–æ¶ˆé™éŸ³
                        avatarVideo.play().catch(e => console.log('æ’­æ”¾è§†é¢‘æ—¶å‡ºé”™:', e));
                    }
                    console.log('å¼€å§‹è¯´è¯ï¼Œæ’­æ”¾è§†é¢‘');
                } else if (!data.is_speaking && isSpeaking) {
                    // åœæ­¢è¯´è¯ï¼Œæš‚åœè§†é¢‘
                    isSpeaking = false;
                    if (avatarVideo) {
                        avatarVideo.pause();
                    }
                    console.log('åœæ­¢è¯´è¯ï¼Œæš‚åœè§†é¢‘');
                }
                
                // å¦‚æœä»åœ¨ç›‘å¬ï¼Œç»§ç»­æ£€æŸ¥çŠ¶æ€
                if (data.is_listening) {
                    speakingInterval = setTimeout(checkVoiceStatus, 1000); // æ¯ç§’æ£€æŸ¥ä¸€æ¬¡
                }
            }
        })
        .catch(error => {
            console.error('æ£€æŸ¥è¯­éŸ³çŠ¶æ€æ—¶å‡ºé”™:', error);
            // å³ä½¿å‡ºé”™ä¹Ÿç»§ç»­æ£€æŸ¥
            speakingInterval = setTimeout(checkVoiceStatus, 2000);
        });
    }

    // é¡µé¢éšè—æ—¶æ¸…ç†å®šæ—¶å™¨
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            if (speakingInterval) {
                clearTimeout(speakingInterval);
            }
        }
    });

    // å®šæœŸæ£€æŸ¥è¯­éŸ³åŠ©æ‰‹çŠ¶æ€
    function checkAssistantStatus() {
        fetch('http://localhost:5001/get_status')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('è¯­éŸ³åŠ©æ‰‹çŠ¶æ€:', data);
            }
        })
        .catch(error => {
            console.error('æ£€æŸ¥çŠ¶æ€æ—¶å‡ºé”™:', error);
        });
    }

    // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡çŠ¶æ€
    setInterval(checkAssistantStatus, 5000);

    // å¥åº·æ£€æŸ¥
    function checkHealth() {
        fetch('http://localhost:5001/health')
        .then(response => response.json())
        .then(data => {
            console.log('æœåŠ¡å™¨çŠ¶æ€:', data);
        })
        .catch(error => {
            console.error('æœåŠ¡å™¨è¿æ¥å¤±è´¥:', error);
        });
    }

    // é¡µé¢è·³è½¬é€»è¾‘
    document.addEventListener('DOMContentLoaded', function() {
        // é¡µé¢è·³è½¬é€»è¾‘
        const toWeatherBtn = document.getElementById('to-weather');
        const toMusicBtn = document.getElementById('to-music');
        const toNovelBtn = document.getElementById('to-novel');
        const toDialogBtn = document.getElementById('to-dialog');
        
        if (toWeatherBtn) {
            toWeatherBtn.addEventListener('click', () => {
                document.getElementById('main-page').style.display = 'none';
                document.getElementById('weather-page').style.display = 'block';
                fetchChangshaWeather();
            });
        }

        if (toMusicBtn) {
            toMusicBtn.addEventListener('click', () => {
                document.getElementById('main-page').style.display = 'none';
                document.getElementById('music-page').style.display = 'block';
            });
        }

        if (toNovelBtn) {
            toNovelBtn.addEventListener('click', () => {
                document.getElementById('main-page').style.display = 'none';
                document.getElementById('bookcase-page').style.display = 'block';
            });
        }

        // ä¿®å¤ï¼šç¡®ä¿å¯¹è¯æŒ‰é’®æ­£ç¡®ç»‘å®šäº‹ä»¶
        if (toDialogBtn) {
            toDialogBtn.addEventListener('click', () => {
                // éšè—æ‰€æœ‰é¡µé¢
                document.querySelectorAll('.container').forEach(container => {
                    container.style.display = 'none';
                });
                // æ˜¾ç¤ºå¯¹è¯é¡µé¢
                document.getElementById('dialog-page').style.display = 'block';
            });
        }

        // è¿”å›æŒ‰é’®é€»è¾‘
        const backButtons = [
            'back-from-weather', 
            'back-from-music', 
            'back-from-novel', 
            'back-to-main-from-dialog',
            'back-from-video'
        ];
        
        backButtons.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('click', () => {
                    document.querySelectorAll('.container').forEach(container => {
                        container.style.display = 'none';
                    });
                    document.getElementById('main-page').style.display = 'block';
                    
                    if (id === 'back-from-video') {
                        stopVoiceRecognition();
                    }
                });
            }
        });

        // å°è¯´é¡µé¢è¿”å›æŒ‰é’®é€»è¾‘
        const backFromNovelBtn = document.getElementById('back-from-novel');
        if (backFromNovelBtn) {
            backFromNovelBtn.addEventListener('click', () => {
                document.getElementById('novel-page').style.display = 'none';
                document.getElementById('bookcase-page').style.display = 'block';
            });
        }

        // å¯¹è¯é¡µé¢åŠŸèƒ½
        document.querySelectorAll('.avatar').forEach(avatar => {
            avatar.addEventListener('click', function() {
                const gender = this.getAttribute('data-gender');
                const person = this.getAttribute('data-person');
                startConversation(gender, person);
            });
        });

        // ç»“æŸå¯¹è¯æŒ‰é’®
        if (stopConversationBtn) {
            stopConversationBtn.addEventListener('click', () => {
                document.getElementById('video-page').style.display = 'none';
                document.getElementById('main-page').style.display = 'block';
                stopVoiceRecognition();
            });
        }

        // ç»‘å®šè¯­éŸ³æ§åˆ¶æŒ‰é’®äº‹ä»¶
        if (replayVoiceBtn) {
            replayVoiceBtn.addEventListener('click', () => {
                if (isSpeaking) {
                    stopWeatherSpeech();
                    // çŸ­æš‚å»¶è¿Ÿåé‡æ–°å¼€å§‹
                    setTimeout(speakWeather, 300);
                } else {
                    speakWeather();
                }
            });
        }

        if (stopVoiceBtn) {
            stopVoiceBtn.addEventListener('click', stopWeatherSpeech);
        }

        // åˆå§‹åŒ–ï¼šé¡µé¢åŠ è½½æ—¶ç«‹å³è¯·æ±‚
        fetchChangshaWeather();

        // å®šæ—¶åˆ·æ–°ï¼šæ¯15åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ï¼ˆå¹³è¡¡å®æ—¶æ€§å’ŒAPIè°ƒç”¨æ¬¡æ•°ï¼‰
        setInterval(fetchChangshaWeather, 15 * 60 * 1000); // 15åˆ†é’Ÿ = 900000æ¯«ç§’

        // è®¾ç½®ä¹¦ç±ç‚¹å‡»äº‹ä»¶
        setupBookItems();

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œå¥åº·æ£€æŸ¥
        checkHealth();
    });
</script>
</body>
</html>
